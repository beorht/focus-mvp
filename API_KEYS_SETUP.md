# Настройка множественных API ключей Gemini

## Зачем нужны множественные ключи?

Бесплатный тариф Gemini API имеет ограничение **20 запросов в день** на один ключ. При использовании нескольких ключей система автоматически переключается на следующий ключ при исчерпании квоты предыдущего.

**Примеры:**
- 1 ключ = 20 запросов/день
- 5 ключей = 100 запросов/день
- 10 ключей = 200 запросов/день

## Как получить API ключи

1. Откройте [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Войдите с помощью Google аккаунта
3. Нажмите **"Create API Key"**
4. Скопируйте сгенерированный ключ
5. Повторите процесс с другими Google аккаунтами для получения дополнительных ключей

## Настройка в проекте

### Вариант 1: Использование одного ключа

```env
GEMINI_API_KEY=your_api_key_here
```

### Вариант 2: Множественные ключи (рекомендуется)

```env
GEMINI_API_KEYS=key1,key2,key3,key4,key5
```

**Важно:**
- Разделяйте ключи запятыми
- Пробелы вокруг ключей автоматически удаляются
- Можно использовать оба параметра одновременно для совместимости

## Как это работает

1. При запросе к API система пытается использовать первый ключ
2. Если получена ошибка квоты (429), автоматически переключается на следующий ключ
3. Процесс повторяется для всех доступных ключей
4. Если все ключи исчерпаны, возвращаются mock данные для тестирования UI

## Логирование

В консоли разработки вы увидите:
```
Attempting with API key #1 of 5
Key #1 quota exceeded, trying next key...
Attempting with API key #2 of 5
```

В meta данных ответа:
```json
{
  "meta": {
    "api_keys_available": 5,
    "ai_model": "Gemini 2.5 Flash"
  }
}
```

## Пример .env.local

```env
# Множественные ключи для ротации
GEMINI_API_KEYS=AIzaSyB...key1,AIzaSyC...key2,AIzaSyD...key3

# Одиночный ключ (для обратной совместимости)
GEMINI_API_KEY=AIzaSyB...key1
```

## Безопасность

⚠️ **Важно:**
- Никогда не коммитьте `.env.local` в git
- Используйте `.env.local.example` для шаблона
- Храните ключи в безопасном месте
- Не делитесь ключами публично

## Мониторинг использования

Отслеживайте использование квоты:
- [Google AI Usage Dashboard](https://ai.dev/usage?tab=rate-limit)

## Troubleshooting

### Ошибка: "No API keys configured"
Убедитесь, что в `.env.local` есть хотя бы один ключ:
```env
GEMINI_API_KEY=your_key_here
```

### Все ключи исчерпаны
Приложение автоматически переключится на mock данные. В консоли вы увидите:
```
MOCK MODE: All 5 API keys exhausted, using fallback data
```

### Ключи не обновляются
Перезапустите сервер разработки:
```bash
npm run dev
```

## Дополнительные ресурсы

- [Gemini API Documentation](https://ai.google.dev/gemini-api/docs)
- [Rate Limits](https://ai.google.dev/gemini-api/docs/rate-limits)
- [Pricing](https://ai.google.dev/pricing)
